<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Crear Cuenta</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
    body{height:100vh;background:linear-gradient(to bottom,#ab29cb,#df5eff,#000,#000);display:flex;justify-content:center;align-items:center;color:white;}
    .card{width:520px;padding:35px;border-radius:22px;background:rgba(255,255,255,0.08);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.2);text-align:center;}
    h2{margin-bottom:15px;}
    .upload-row{display:flex;justify-content:center;align-items:center;gap:12px;margin-bottom:20px;}
    .profile-upload{width:110px;height:110px;border-radius:50%;background:rgba(255,255,255,0.15);display:flex;justify-content:center;align-items:center;cursor:pointer;position:relative;overflow:hidden;}
    .profile-upload img{width:100%;height:100%;object-fit:cover;}
    .overlay{position:absolute;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;opacity:0;transition:.3s;font-size:12px;padding:10px;}
    .profile-upload:hover .overlay{opacity:1;}
    .delete-photo{font-size:22px;cursor:pointer;opacity:.7;transition:.2s;}
    .delete-photo:hover{opacity:1;transform:scale(1.1);}
    input{width:100%;padding:11px;margin-bottom:3px;border-radius:12px;border:none;outline:none;background:rgba(255,255,255,0.15);color:white;}
    input::placeholder{color:rgba(255,255,255,0.7);}
    .error{text-align:left;font-size:12px;color:red;margin-bottom:8px;min-height:14px;}
    .password-wrapper{position:relative;}
    .eye{position:absolute;right:12px;top:11px;cursor:pointer;}
    .btn{width:100%;padding:12px;border-radius:12px;border:none;background:#1e90ff;color:white;font-weight:bold;cursor:pointer;margin-top:10px;}
    .btn:hover{background:#0f6ad6;}
    .msg{margin-top:10px;font-weight:bold;min-height:20px;}
  </style>
</head>
<body>

<div class="card">
  <h2>Crear Cuenta</h2>

  <div class="upload-row">
    <label class="profile-upload">
      <img id="preview" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png">
      <div class="overlay">Sube desde la computadora</div>
      <input type="file" id="foto" accept="image/png, image/jpeg" hidden>
    </label>
    <span class="delete-photo" onclick="eliminarFoto()">üóë</span>
  </div>

  <input type="text" id="usuario" placeholder="Usuario">
  <div class="error" id="errorUsuario"></div>

  <input type="email" id="correo" placeholder="Correo electr√≥nico">
  <div class="error" id="errorCorreo"></div>

  <div class="password-wrapper">
    <input type="password" id="password" placeholder="Contrase√±a">
    <span class="eye" onclick="togglePassword()">üëÅ</span>
  </div>
  <div class="error" id="errorPassword"></div>

  <button class="btn" onclick="crearCuenta()">¬°Crear Cuenta!</button>
  <div class="msg" id="mensaje"></div>
</div>

<script>
const fotoInput=document.getElementById("foto");
const preview=document.getElementById("preview");
const usuarioInput=document.getElementById("usuario");
const correoInput=document.getElementById("correo");
const passwordInput=document.getElementById("password");
const errorUsuario=document.getElementById("errorUsuario");
const errorCorreo=document.getElementById("errorCorreo");
const errorPassword=document.getElementById("errorPassword");
const DEFAULT_IMG="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png";

document.querySelector(".profile-upload").addEventListener("click",()=>fotoInput.click());
fotoInput.addEventListener("change",()=>{
  const file=fotoInput.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=e=>preview.src=e.target.result;
    reader.readAsDataURL(file);
  }
});
function eliminarFoto(){fotoInput.value="";preview.src=DEFAULT_IMG;}
function togglePassword(){passwordInput.type=passwordInput.type==="password"?"text":"password";}
function validarCorreo(c){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c);}
function validarPassword(p){return /^(?=.*[A-Z]).{8,}$/.test(p);}

usuarioInput.addEventListener("input",()=>errorUsuario.textContent=usuarioInput.value.includes(" ")?"No debe contener espacios":"");
correoInput.addEventListener("input",()=>errorCorreo.textContent=!validarCorreo(correoInput.value)?"Correo no v√°lido":"");
passwordInput.addEventListener("input",()=>errorPassword.textContent=!validarPassword(passwordInput.value)?"M√≠nimo 8 caracteres y 1 may√∫scula":"");

async function crearCuenta(){
  const usuario=usuarioInput.value.trim();
  const correo=correoInput.value.trim();
  const password=passwordInput.value;
  const mensaje=document.getElementById("mensaje");

  if(!usuario||!correo||!password){
    mensaje.textContent="Completa los campos obligatorios";
    mensaje.style.color="orange";
    return;
  }

  if(usuario.includes(" ")||!validarCorreo(correo)||!validarPassword(password)){
    mensaje.textContent="Corrige los errores";
    mensaje.style.color="orange";
    return;
  }

  try{
    const response=await fetch("https://backend902.onrender.com/signup",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({username:usuario,email:correo,password})
    });

    const data=await response.json();

    if(response.ok){
      mensaje.textContent="Cuenta creada correctamente ‚úÖ";
      mensaje.style.color="lightgreen";
      setTimeout(()=>window.location.href="index.html",1500);
    }else{
      mensaje.textContent=data.message;
      mensaje.style.color="red";
    }

  }catch(err){
    mensaje.textContent="Error al conectar con el servidor";
    mensaje.style.color="red";
  }
}
</script>
</body>
</html>
